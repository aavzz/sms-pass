// UI strings and messages in different languages
let appStrings = {

    ru: {
        enterPhoneNumber: "Введите номер телефона",
        passwordWillBeSent: "Пароль будет выслан на указанный номер",
        send: 'Отправить',
        clear: 'Стереть',
        enterPassword: "Введите пароль",
        passwordWasSent: "Пароль был выслан на номер",
        newPass: "Запросить новый",
        readRules: "Ознакомьтесь с правилами",
        hotspotOwner: "Пункт коллективного доступа ООО \"Рога и копыта\"",
        provider: "Услуги связи предоставляются ООО \"Теликс\"",
        rules: `
<p style="line-height: 1.4; padding-bottom: 12px; font-weight: bold;">Правила и условия использования сетью Wi-Fi (WiFi Хотспот) на объектах ООО «Байкальский Горнолыжный Курорт «Гора Соболиная»
<p style="line-height: 1.4; padding-bottom: 10px;">1. Доступ к сети Интернет, посредством WiFi Хотспот, не является коммерческой услугой и предоставляется гостям заведения на безвозмездной основе.
<p style="line-height: 1.4; padding-bottom: 5px; font-weight: bold">2. Пользователю Хотспота запрещено:
<p style="line-height: 1.4; padding-bottom: 5px;">2.1. Размещать информацию, распространение которой ограничено законодательством Российской Федерации, в том числе призывов к национальной розни, информации оскорбительного, угрожающего, клеветнического, порнографического и прочего содержания, нарушающей законодательство Российской Федерации.
<p style="line-height: 1.4; padding-bottom: 5px;">2.2. Распространять информацию, оскорбляющую честь, достоинство и деловую репутацию пользователей сети Интернет.
<p style="line-height: 1.4; padding-bottom: 5px;">2.3. Нарушать авторские права на информацию, размещенную в сети Интернет.
<p style="line-height: 1.4; padding-bottom: 5px;">2.4. Заниматься массовой рассылкой, не запрошенной адресатом, сообщений коммерческого, агитационного и иного содержания (спам рассылка).
<p style="line-height: 1.4; padding-bottom: 5px;">2.5. Коммерческое использование Услуг с целью получения прибыли.
<p style="line-height: 1.4; padding-bottom: 5px;">2.6. Осуществлять любые действия, такие как: DoS-атаки, генерация паразитного трафика, флуд и т.п., которые могут привести к нарушению функционирования сети Хотспот.
<p style="line-height: 1.4; padding-bottom: 10px;">2.7. Публиковать или передавать любую информацию или программное обеспечение, которое содержит в себе компьютерные «вирусы».
<p style="line-height: 1.4; padding-bottom: 5px; font-weight: bold;">3. Администрация заведения не несет ответственность:
<p style="line-height: 1.4; padding-bottom: 5px;">3.1. За любые затраты или ущерб, прямо или косвенно возникшие в результате самостоятельного получения или передачи Пользователем Хотспот информации и Услуг через сеть Интернет и сеть передачи данных.
<p style="line-height: 1.4; padding-bottom: 5px;">3.2. За ущерб, возникший при несанкционированном доступе третьих лиц к ресурсам или устройствам Пользователя Хотспот, а также при разглашении Пользователем учетной информации (логин, пароль и другой информации).
<p style="line-height: 1.4; padding-bottom: 5px;">3.3. За ущерб, нанесенный Пользователю Хотспот в результате действия программных продуктов, полученных Пользователем в результате получения доступа к сети Интернет.
<p style="line-height: 1.4; padding-bottom: 5px;">3.4. За качество предоставляемых услуг доступа к сети Интернет в случаях использования Пользователем Хотспота неисправного или несертифицированного оборудования, программного обеспечения, а также при неверной настройке Пользователем программного и технического обеспечения доступа к сети Интернет.
<p style="line-height: 1.4; padding-bottom: 5px;">3.5. За прямой или косвенный ущерб, полученный в результате ошибок, утраты данных, задержек, обрывов в работе сети Интернет или передаче данных.
<p style="line-height: 1.4; padding-bottom: 10px;">3.6. За обхват WiFi сигнала и пропускную способность WiFi сети.
<p style="line-height: 1.4; padding-bottom: 5px; font-weight: bold;">4. Владелец Wi-Fi Хотспота вправе направлять Пользователю сообщения рекламно-информационного характера посредством рассылок с информацией о новых тарифах, скидках, акциях, новостях компании и т.п. Частота рассылок определяется Владелец Wi-Fi Хотспота самостоятельно, в одностороннем порядке.
<p style="line-height: 1.4; padding-bottom: 5px;">4.1. Пользователь выражает согласие и разрешает владельцу Wi-Fi Хотспота обрабатывать свои персональные данные (номер мобильного телефона), включая сбор, систематизацию, накопление, хранение, уточнение (обновление, изменение), использование, обезличивание, блокирование, уничтожение персональных данных, передачу в службы охраны правопорядка при оперативно-розыскных мероприятиях.
<p style="line-height: 1.4; padding-bottom: 10px;">4.2. Пользователь выражает согласие и разрешает владельцу Wi-Fi Хотспота объединять персональные данные в информационную систему персональных данных и обрабатывать мои персональные данные, указанные выше, с помощью средств автоматизации, а также иных программных средств, специально разработанных по поручению владельца Wi-Fi Хотспота и/или третьих лиц.
<p style="line-height: 1.4; padding-bottom: 10px; font-weight: bold;">5. Отправляя запрос на смс пользователь соглашается с данными условиями и подтверждает свою возрастную категорию 18+.
<p style="line-height: 1.4; font-weight: bold;">6. Если пользователь Хотспот не согласен с данными условиями, то пользователь обязуется немедленно прекратить пользование услугой. 
`,
        agree: 'Согласен',
        doNotAgree: 'Не согласен',
        denyAccess: 'Для получения доступа необходимо согласиться с Правилами'
    },

    en: {

    },

    es: {

    },

}

let appStr = appStrings.ru;

////////////////////////////////////////////////////////////////////////

function mkLayout() {

    let top = 'background-color: #ffffff;';
    let bottom = 'background-color: #ffffff; padding-top: 10px;';
    $('#root').w2layout({
        name: 'myLayout',
        panels: [
            { type: 'top', size: 150, style: top, content: '<div style="font-size: 11px;"><center><img src="rk.png" alt="Roga&Kopyta logo" height="110" width="110"><p>' + appStr.hotspotOwner + '</center></div>',},
            { type: 'main', size: 200, },
            { type: 'bottom', size: 150, style: bottom, content: '<div style="font-size: 11px;"><center><img src="telix3.png" alt="Telix logo" height="94" width="188"><p>' + appStr.provider + '</center></div>',},
        ],
    });
}

////////////////////////////////////////////////////////////////////////

function mkRulesForm() {

    $('#formRules').w2form({ 
        name: 'formRules',
        header: appStr.readRules,
        formHTML: 
            '<div class="w2ui-page page-0">'+
            '    <div style="width: 380px; height: 50px; font-size: 12px; display: block; margin-left: auto; margin-right: auto;">'+
            '        ' + appStr.rules + 
            '    </div>'+
            '</div>'+
            '<div class="w2ui-buttons">'+
            '   <button class="btn" name="reset">' + appStr.doNotAgree + '</button>'+
            '   <button class="btn btn-green" name="save">' + appStr.agree + '</button>'+
            '</div>',
        actions: {
            "reset": function () { alert(appStr.denyAccess); },
            "save": function () {
                        mkPhoneForm();
                        $('input[name="phone"]').mask('+7 (9ZZ) ZZZ-ZZ-ZZ', {placeholder: "9XX XXX XX XX", clearIfNotMatch: true, translation: { Z: {pattern: /\d/}, 9: {pattern: /9/}}});
                        w2ui['myLayout'].content('main', w2ui['formPhone']);
                    }
        },
    });
}

////////////////////////////////////////////////////////////////////////

function mkPhoneForm() {

    $('#formPhone').w2form({ 
        name: 'formPhone',
        header: appStr.enterPhoneNumber,
        formHTML: 
            '<div class="w2ui-page page-0">'+
            '    <div style="width: 380px; height: 50px; font-size: 12px; display: block; margin-left: auto; margin-right: auto;">'+
            '        <p style="line-height: 1.4;">' + appStr.enterPhoneNumber + '.' +
            '        <p style="line-height: 1.4;">' + appStr.passwordWillBeSent + '.' +
            '    </div>'+
            '    <div class="w2ui-field">'+
            '        <div>'+
            '            <input id="p2" class="input-phone" name="phone" maxlength="15" size="15"/>'+
            '        </div>'+
            '    </div>'+
            '</div>'+
            '<div class="w2ui-buttons">'+
            '   <button class="btn" name="reset">' + appStr.clear + '</button>'+
            '   <button class="btn btn-green" name="save">' + appStr.send + '</button>'+
            '</div>',
        fields : [
            { name: 'phone', type: 'text', },
        ],
        actions: {
            "reset": function () { this.clear(); },
            "save": function () {
                        let phone = w2ui['formPhone'].record.phone.replace(/[^0-9]/g, "").replace(/^7/, "");
                        let reg = /^\d{10}$/;
                        if (phone != undefined && reg.test(phone)) {
                            let params = {
                                operation: "pass",
                                login: phone,
                            }
                            $.get("/api1", params, function(data) {
                                if (data.Error == 0) {
                                    mkPasswdForm(w2ui['formPhone'].record.phone);
                                    $('input[name="pass"]').mask('00000', {placeholder: "XXXXX", clearIfNotMatch: true, });
                                    w2ui['myLayout'].content('main', w2ui['formPassword']);
                                }
                                else {
                                    alert("Failed to send password")
                                    this.clear();
                                }
                            },"json")
                        }
                    }
        },
    });
}

////////////////////////////////////////////////////////////////////////

function mkPasswdForm(phone) {

    $('#formPassword').w2form({
        name   : 'formPassword',
        header   : appStr.enterPassword,
        formHTML:
            '<div class="w2ui-page page-0">'+
            '    <div style="width: 380px; height: 50px; font-size: 12px; display: block; margin-left: auto; margin-right: auto;">'+
            '        <p style="line-height: 1.4;">' + appStr.enterPassword + '.'+
            '        <p style="line-height: 1.4;">' + appStr.passwordWasSent + ' ' + phone + '.'+
            '    </div>'+
            '    <div class="w2ui-field">'+
            '        <div>'+
            '            <input id="p3" class="input-phone" name="pass" maxlength="15" size="15"/>'+
            '        </div>'+
            '    </div>'+
            '</div>'+
            '<div class="w2ui-buttons">'+
            '   <button class="btn" name="newpass">' + appStr.newPass + '</button>'+
            '   <button class="btn" name="reset">' + appStr.clear + '</button>'+
            '   <button class="btn btn-green" name="save">' + appStr.send + '</button>'+
            '</div>',
        fields : [
            { name: 'pass', type: 'text', },
        ],
        actions: {
            "reset": function () { this.clear(); },
            "save": function () { alert(w2ui['formPassword'].record.pass); },
            "newpass": function () {
                           w2ui['myLayout'].content('main', w2ui['formPhone']);
            },
        },
    });
    w2ui['formPassword'].record.pass="";
}

////////////////////////////////////////////////////////////////////////

$(function(){

    mkLayout();
    mkRulesForm();
    w2ui['myLayout'].content('main', w2ui['formRules']);
});
